# =================================
# ALB Ingress - Path 기반 라우팅 (도메인 없어도 OK!)
# =================================
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: petful-ingress
  annotations:
    # AWS Load Balancer Controller 설정
    kubernetes.io/ingress.class: alb
    alb.ingress.kubernetes.io/scheme: internet-facing
    alb.ingress.kubernetes.io/target-type: ip

    # Load Balancer 설정
    alb.ingress.kubernetes.io/load-balancer-name: petful-alb
    alb.ingress.kubernetes.io/group.name: petful

    # Health Check 설정
    alb.ingress.kubernetes.io/healthcheck-protocol: HTTP
    alb.ingress.kubernetes.io/healthcheck-path: /
    alb.ingress.kubernetes.io/healthcheck-interval-seconds: "30"
    alb.ingress.kubernetes.io/healthcheck-timeout-seconds: "5"
    alb.ingress.kubernetes.io/healthy-threshold-count: "2"
    alb.ingress.kubernetes.io/unhealthy-threshold-count: "2"

    # SSL 설정 (필요시 주석 해제)
    # alb.ingress.kubernetes.io/certificate-arn: arn:aws:acm:region:account:certificate/certificate-id
    # alb.ingress.kubernetes.io/ssl-redirect: '443'

    # ArgoCD sync wave
    argocd.argoproj.io/sync-wave: "4"
spec:
  rules:
    # 호스트명 없이 Path 기반 라우팅 - ALB 자동 생성 도메인 사용
    - http:
        paths:
          # API 라우팅 (우선순위 높음)
          - path: /api
            pathType: Prefix
            backend:
              service:
                name: gateway-service
                port:
                  number: 8000

          # Frontend 라우팅 (기본 경로)
          - path: /
            pathType: Prefix
            backend:
              service:
                name: petful-frontend-service
                port:
                  number: 3000
